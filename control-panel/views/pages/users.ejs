<%- include('../partials/head'); %>

<body id="page-top">
  <div id="wrapper">

    <%- include('../partials/sidebar'); %>

    <div id="content-wrapper" class="d-flex flex-column">
      <div id="content">

        <%- include('../partials/nav'); %>

        <div class="container-fluid">

          <h1 class="h3 mb-2 text-gray-800">Users Control Panel</h1>
          <% if (alert) { %>
          <p class="mb-4 p-2 alert-success"> <%= alert %> </p>
          <% } %>
          <p class="mb-4 p-2 alert-info"><i class="fa fa-lock"></i> Passwords are <strong>salted</strong> and stored in
            <strong>SHA256 hashes</strong> for security. No plain text passwords are stored. </p>


          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">All Users</h6>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table id="user-table" class="table table-bordered" width="100%" cellspacing="0">
                  <thead class="thead-dark">
                    <tr>
                      <th>Username</th>
                      <th>First name</th>
                      <th>Last name</th>
                      <th>Email</th>
                      <th><i class="fa fa-lock"></i> Encrypted Password</th>
                      <th>Role</th>
                    </tr>
                  </thead>
                  <tbody>

                    <% users.forEach(function(row){ %>
                    <tr>
                      <td><%= row.username %></td>
                      <td><%= row.fname %></td>
                      <td><%= row.lname[0] %>*******</td>
                      <td><%= row.email.split('@')[0] %>@************</td>
                      <td><%= row.pass %></td>
                      <td><%= row.role %></td>
                    </tr>
                    <% }); %>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <% if (user.role === 'admin') { %>
          <div class="card shadow mb-4">
            <div class="card-header py-3">
              <h6 class="m-0 font-weight-bold text-primary">Create New User</h6>
            </div>
            <div class=" d-flex justify-content-center">
              <div class="card-body" style="max-width: 500px;">
                <form action="" method="post">
                  <div class="form-group">
                    <label for="fname">First name</label>
                    <input required type="text" class="form-control" id="fname" name="fname">
                  </div>
                  <div class="form-group">
                    <label for="fname">Last name</label>
                    <input required type="text" class="form-control" id="lname" name="lname">
                  </div>
                  <div class="form-group">
                    <label for="fname">Username</label>
                    <input required type="text" class="form-control" id="username" name="username">
                  </div>
                  <div class="form-group">
                    <label for="email">Email </label>
                    <input required type="email" class="form-control" name="email" id="email">
                  </div>
                  <div class="form-group">
                    <label for="pass">Password</label>
                    <input required type="password" class="form-control" id="pass" name="pass">
                  </div>
                  <div class="form-check">
                    <input type="checkbox" class="form-check-input" name="admin" id="admin">
                    <label required class="form-check-label" for="admin">set user as admin</label>
                  </div>
                  <button type="submit" id="addUserBtn" class="btn btn-primary mt-3"><i class="fa fa-plus"></i> Add new
                    user</button>
                </form>

              </div>
            </div>
          </div>
          <% } %>
        </div>

      </div>
      <%- include('../partials/footer'); %>

    </div>

  </div>

  <%- include('../partials/modals'); %>
  <%- include('../partials/scripts'); %>

</body>

</html>